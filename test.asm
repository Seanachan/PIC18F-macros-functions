
#INCLUDE <p18f4520.inc>
    CONFIG OSC = INTIO67   
    CONFIG WDT = OFF       

    ORG 0x00
    
MND_HH EQU 0x30
MND_HL EQU 0x31 
MND_LH EQU 0x32
MND_LL EQU 0x33
MER_H EQU 0x40
MER_L EQU 0x41
CNT EQU 0x03		; shift counter
AA EQU 0x02
FANS_H EQU 0x10
FANS_L EQU 0x11


MOVLF MACRO N, D
    MOVLW N
    MOVWF D
    ENDM

ADD16 MACRO
    BCF STATUS, C
    MOVF MND_LL, W
    ADDWF 0x23, F
    MOVF MND_LH, W
    ADDWFC 0x22, F
    MOVF MND_HL, W
    ADDWFC 0x21, F
    MOVF MND_HH, W
    ADDWFC 0x20, F
    ENDM

SHIFT_BOTH MACRO
    BCF STATUS, C
    RLCF MND_LL
    RLCF MND_LH
    RLCF MND_HL
    RLCF MND_HH
    BCF STATUS, C
    RRCF MER_H
    RRCF MER_L
    ENDM
    
FACT MACRO
    LOCAL _LOOP
    MOVLF 0x00, AA
    MOVLF 0x01, FANS_L
    MOVLF 0x00, FANS_H
_LOOP:
    CLRF MER_H
    MOVFF AA, MER_L
    MOVFF FANS_H, MND_LH
    MOVFF FANS_L, MND_LL
    RCALL MULTI
    MOVFF 0x23, FANS_L
    MOVFF 0x22, FANS_H
    CLRF 0x20
    CLRF 0x21
    CLRF 0x22
    CLRF 0x23
    DECFSZ AA
    GOTO _LOOP
    GOTO FIN
    ENDM
    
    FACT
  
MULTI:
    MOVLF 0x10, CNT
LOOP:
    BTFSS MER_L, 0
    GOTO CONTI
    ADD16
CONTI:
    SHIFT_BOTH
    DECFSZ CNT
    GOTO LOOP
    RETURN
FIN:
    NOP
    END


